# Mouseless Grid Configuration Generator

Generates [mouseless](https://mouseless.click/) grid overlay configuration from your QMK Charybdis keymap, ensuring the grid keys stay synchronized with your BASE layer layout.

## Quick Start

```bash
# Generate mouseless grid configuration
just mouseless

# Or run the script directly
python scripts/generate_mouseless_grid.py keymap-drawer/charybdis.json
```

This creates `mouseless_grid_config.yaml` with grid keys extracted from your QMK keymap.

## Applying to Mouseless

1. Review the generated `mouseless_grid_config.yaml`
2. Copy the `keys` and `subgrid_mouse_action_keys` values
3. Update `~/.mouseless/configs/config.yaml`:
   ```yaml
   grid_configs:
     - grid_defn:
         - keys: "=UOYQ KHTNS ZPDLX ',.;/ -EAIC JMGFV"  # Paste here
       subgrid_mouse_action_keys: "=UOY KHTNS..."      # Paste here
   ```
4. Restart mouseless or reload config (`cmd+shift+r`)

## When to Regenerate

Run `just mouseless` whenever you modify your BASE layer layout in `yuanw.c`:

```bash
# Typical workflow after changing keymap
vim yuanw.c              # Edit keymap
just keymap charybdis    # Regenerate visualization (updates JSON)
just mouseless           # Regenerate mouseless grid
cat mouseless_grid_config.yaml  # Review changes
# Copy to ~/.mouseless/configs/config.yaml
```

## How It Works

The script:
1. Reads `keymap-drawer/charybdis.json` (generated by `just keymap`)
2. Extracts the BASE layer (first 30 keys = 3×5 main matrix per hand)
3. Transforms QMK keycodes to physical characters:
   - `KC_Q` → `Q`
   - `HRM_C` → `C` (strips home row mod prefix)
   - `KC_COMM` → `,`
   - `LR_DOT` → `.`
4. Arranges into mouseless 10×3 grid format (left hand reversed + right hand)
5. Generates subgrid by excluding mouse action keys (Q, F, V, J, /)

## Grid Layout

The mouseless grid mirrors your physical keyboard layout:

```
Row 0 (top):    =UOYQ | KHTNS
Row 1 (middle): ZPDLX | ',.;/
Row 2 (bottom): -EAIC | JMGFV
                LEFT  | RIGHT
```

Each row shows 5 left-hand keys (reversed for natural reading) + 5 right-hand keys.

## Notes

- **Combos**: Keys like 'B' and 'W' are created via combos in your keymap, not present in the BASE layer
- **Subgrid**: Excludes Q, F, V, J, / which are typically used for mouse actions in mouseless
- **Single source of truth**: Your keymap (`yuanw.c`) is the canonical source; mouseless config is generated from it
- **Safe workflow**: Script outputs to a file for review before applying, preventing accidental overwrites

## Troubleshooting

**JSON file not found:**
```bash
# Generate the JSON first
just keymap charybdis
just mouseless
```

**Grid doesn't match physical layout:**
- Verify you're using the Charybdis keymap (not Imprint)
- Check that `yuanw.c` has the expected BASE layer layout
- Regenerate the JSON: `just keymap charybdis`
